#!/usr/bin/env php
<?php

use BrasseursDApplis\Arrows\App\Message\ArrowsMessageComponent;
use BrasseursDApplis\Arrows\App\Repository\InMemorySessionRepository;
use BrasseursDApplis\Arrows\Id\ResearcherId;
use BrasseursDApplis\Arrows\Id\SessionId;
use BrasseursDApplis\Arrows\Id\SubjectId;
use BrasseursDApplis\Arrows\Session;
use BrasseursDApplis\Arrows\VO\Orientation;
use BrasseursDApplis\Arrows\VO\Position;
use BrasseursDApplis\Arrows\VO\Scenario;
use BrasseursDApplis\Arrows\VO\Sequence;
use BrasseursDApplis\Arrows\VO\SequenceCollection;
use BrasseursDApplis\Arrows\VO\SubjectsCouple;
use Ramsey\Uuid\Uuid;
use Ratchet\App;

require dirname(__DIR__) . '/vendor/autoload.php';

$session = new Session(
    new SessionId('ddf5ddfa-0990-4c30-9c4c-db2214ed06c1'),
    new Scenario(
        new SequenceCollection(
            [
                new Sequence(
                    Position::top(),
                    Orientation::left(),
                    Orientation::right(),
                    Orientation::left()
                ),
                new Sequence(
                    Position::top(),
                    Orientation::right(),
                    Orientation::right(),
                    Orientation::left()
                ),
                new Sequence(
                    Position::top(),
                    Orientation::left(),
                    Orientation::right(),
                    Orientation::right()
                ),
                new Sequence(
                    Position::top(),
                    Orientation::left(),
                    Orientation::left(),
                    Orientation::right()
                )
            ]
        )
    ),
    new SubjectsCouple(new SubjectId(Uuid::uuid4()), new SubjectId(Uuid::uuid4())),
    new ResearcherId(Uuid::uuid4())
);
$sessionRepository = new InMemorySessionRepository();
$sessionRepository->persist($session);
$messageComponent = new ArrowsMessageComponent($sessionRepository);

$app = new App('localhost', 8080);
$app->route('/arrows/{sessionId}/{role}', $messageComponent, ['*']);
$app->run();
